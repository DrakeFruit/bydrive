@using Sandbox.UI;
@using System.Linq;
@using System.Collections.Generic;
@inherits PanelComponent
@namespace Bydrive

<root>
	<div class="title">Bydrive</div>
	<div class="button singleplayer" @onclick=@OnClickSingleplayer>Singleplayer</div>
	<div class="button multiplayer" @onclick=@OnClickMultiplayer>Multiplayer</div>
	<div class="button dev" @onclick=@OnClickDevStart>Test Race</div>
</root>

@code {
	[Property] public SoundEvent BackgroundMusic { get; set; }

	void OnClickSingleplayer()
	{
		OnClickDevStart();
	}

	void OnClickMultiplayer()
	{
		
	}

	void OnClickDevStart()
	{
		// Load race testing env
		RaceDefinition testDefinition = ResourceLibrary.Get<RaceDefinition>("data/devtest1.race");
		PrefabFile playerPrefab = ResourceLibrary.Get<PrefabFile>("prefabs/dev_car_player.prefab");
		PrefabFile botPrefab = ResourceLibrary.Get<PrefabFile>("prefabs/dev_car_bot.prefab");

		List<RaceInformation.Participant> participants = new()
		{
			new(botPrefab, "Bot 1", 1),
			new(botPrefab, "Bot 2", 2),
			new(botPrefab, "Bot 3", 3),
			new(playerPrefab, "Player", 4)
		};

		Music.Stop();
		RaceInformation info = new(testDefinition, participants, true);
	}

	protected override void OnEnabled()
	{
		base.OnEnabled();
		IntroPlayer.OnIntroComplete += PlayMusic;
	}

	private void PlayMusic(IntroPlayer _)
	{
		Music.Play(BackgroundMusic);
	}
}